<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-dark mb-0">
      <i class="bi bi-tags-fill me-2"></i> Brands
    </h2>
    <button type="button" class="btn btn-danger px-4 py-2 shadow-sm" (click)="openCreateModal()">
      <i class="bi bi-plus-circle me-2"></i> Add Brand
    </button>
  </div>

  <div class="row g-3">
    <div class="col-12" *ngFor="let marque of marques; trackBy: trackByCodeMarque">
      <div class="card marque-card border-0 shadow-sm">

        <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-md-center">

          <div class="d-flex align-items-center mb-3 mb-md-0">
            <img 
              *ngIf="marque.logo; else noLogo"
              [src]="marque.logo"
              alt="Logo"
              class="rounded me-3"
              style="width: 60px; height: 60px; object-fit: cover;">

            <ng-template #noLogo>
              <div class="bg-light text-muted d-flex align-items-center justify-content-center rounded me-3"
                   style="width: 60px; height: 60px;">
                No Logo
              </div>
            </ng-template>

            <div>
              <h5 class="card-title mb-1 fw-semibold text-dark">{{ marque.libelle }}</h5>
              <p class="mb-1 text-muted small">Code: {{ marque.codeMarque }}</p>
              <span class="badge" [ngClass]="marque.actif ? 'bg-success' : 'bg-danger'">
                {{ marque.actif ? 'Active' : 'Inactive' }}
              </span>
            </div>
          </div>

          <div class="d-flex flex-wrap gap-2">
            <button type="button" class="btn btn-warning btn-sm px-3" (click)="openEditModal(marque)">
              <i class="bi bi-pencil me-1"></i> Edit
            </button>

            <button type="button" class="btn btn-danger btn-sm px-3" (click)="deleteMarque(marque.codeMarque)">
              <i class="bi bi-trash me-1"></i> Delete
            </button>

            <button type="button" class="btn btn-secondary btn-sm px-3" (click)="onToggleActif(marque)">
              <i class="bi bi-power me-1"></i> {{ marque.actif ? 'Deactivate' : 'Activate' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="marqueModal" tabindex="-1" aria-labelledby="marqueModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content border-0 shadow rounded">
      <form (ngSubmit)="onSubmit()" #marqueForm="ngForm">
        <div class="modal-header bg-white border-bottom">
          <h5 class="modal-title text-dark fw-semibold" id="marqueModalLabel">
            {{ isEdit ? 'Edit Brand' : 'Add Brand' }}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="mb-3">
            <label for="codeMarque" class="form-label">Code</label>
            <input type="number" id="codeMarque" [(ngModel)]="selectedMarque.codeMarque" name="codeMarque"
                   class="form-control" [readonly]="isEdit" [disabled]="isEdit" required />
          </div>

          <div class="mb-3">
            <label for="libelle" class="form-label">Label</label>
            <input type="text" id="libelle" [(ngModel)]="selectedMarque.libelle" name="libelle" class="form-control"
                   required />
          </div>

          <div class="mb-3">
            <label for="logo" class="form-label">Logo URL</label>
            <input type="text" id="logo" [(ngModel)]="selectedMarque.logo" name="logo" class="form-control" />
          </div>

          <div class="mb-3">
            <label for="codeGamme" class="form-label">Category</label>
            <select id="codeGamme" [(ngModel)]="selectedMarque.codeGamme" name="codeGamme" class="form-select" required>
              <option *ngFor="let gamme of gammes" [value]="gamme.codeGamme">{{ gamme.libelle }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="flag" class="form-label">Status</label>
            <select id="flag" [(ngModel)]="selectedMarque.actif" name="flag" class="form-select" required>
              <option [ngValue]="true">Active</option>
              <option [ngValue]="false">Inactive</option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-danger px-4" [disabled]="!marqueForm.form.valid">
            <i class="bi bi-save me-1"></i> {{ isEdit ? 'Update' : 'Create' }}
          </button>
          <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal">
            <i class="bi bi-x-lg me-1"></i> Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
